
\section{Design}
\label{sec:design}

\subsection{External factor collection}
\label{subsec:external}
Sensing module is mainly designed for collected the external factors of users.

\paragraph{Food intake}
As the food intake is a main source of carbohydrate, \sysname provides the food menu for users to record their daily intakes based on the carbohydrate food list \cite{bib:carblist}.
Five common food categories have been provided by \sysname, including grains ,vegetables, mike and egg,fruits and meats. The users are asked to enter their food items and the corresponding amounts. \sysname calculate the carbohydrate of a meal and measure its impact on blood glucose level.

\paragraph{Drug intake}
The oral diabetes medications enhance secretion of insulin into the blood by the pancreas or decrease amount of glucose released from liver, keeping the blood glucose in a low level for type II diabetes.
In \sysname, a drug menu of 11 oral diabetes is report for users to input their drug intake. After eating the diabetes drugs, users select their pills name and report the drug dosage. The drug list is provided based on \cite{bib:druglist}.
\sysname transfers the drug dose as the blood glucose efforts according to their work functions \cite{bib:druglist, bib:bolen2007systematic, bib:bennett2011oral}  by physiological model.

\paragraph{Insulin injection}
Insulin injection is to control blood glucose concentration of those who have type I diabetes, and the patients of type II, whose blood sugar is too high for their bodies to control. \sysname provides a insulin type list based on \cite{bib:insulinlist} for user with diabetes to enter their usage and insulin dosage, and then transfer it into physiological model to compute the blood glucose level.

\paragraph{Activity factors}
Since the carbohydrate in the body can be consumed by daily exercise, resulting to varying the blood glucose level, \sysname adopts an effective and power efficient approach \cite{bib:kwapisz2011activity} to automatically recognize six common user's daily activities (i.e., walking, running, upstairs, downstairs, sitting and standing), and record the corresponding durations. The caloric expenditure can be easily consumed by the calorie burn calculator formulas as Equation ~\ref{calorie_burn}.
\begin{equation}\label{calorie_burn}
  Calorie Burn = (BMR/24)*MET*T,
\end{equation}
where BMR (Basal Methobolic Rate) is the amount of energy required to simply sit or lie quietly \cite{bib:mcnab1997utility}, and MET (Metabolic Equivalent) is the ratio of the work metabolic rate to the resting metabolic rate\cite{bib:ainsworth2000compendium}. The calculator formula has been widely used by multiple sport applications \cite{bib:shapesense, bib:HealthStatus, bib:CalorieCounter}.
\sysname finally leverages the calories to measure the effects of exercise on the blood glucose.

\paragraph{Sleep quality}
Sleep quality has a long influence on blood glucose level. To measure the sleep quality of users, \sysname applies an effective method in \cite{bib:gu2014intelligent} to measure the sleep quality, and leverages the sleep quality score as an index to evaluate the sleeping impact on blood glucose level.

\subsection{Feature Engineering of Physiological-Temporal Views }
\subsubsection{Physiological View}

\begin{figure}[t]
  \centering
  \includegraphics[width=0.9\columnwidth]{./img/Physiological_correlation1.pdf}
  \caption{Temporal graph of the physiological model.}
  \label{fig:phymodel}
\end{figure}
The feature engineering of physiological view is to leverage a physiological model to quantify the dynamics of physiological factors in the body. The
physiological model, based on the physiology mechanism of blood glucose in Section~\ref{sec:preliminary}, has been widely studied in previous works \cite{bib:briegel2002nonlinear,bib:duke2010intelligent, bib:plis2014machine}.It primarily measures the real-time values of carbohydrate, insulin and glucose influenced by the external factors. We constructed our physiological model based on the work \cite{bib:duke2010intelligent},
with an extension of sleeping fact according to its physiological impact discussed in Section~\ref{sec:preliminary}.

\paragraph{Temporal Graph of Physiological Model}
The physiological model of \sysname describes the physiological factors from five aspects: carbohydrate dynamics, insulin dynamics, exercise dynamics,
sleep dynamics and blood glucose dynamics.
%Given the hidden physiological vectors $X_{t}=\{C_{g1}(t), C_{g2}(t),\\ I_{s}(t),I_{m}(t), I_{t}, G_{m}(t), G(t), E(t)\}$, where the elements of this vector represent
%the hidden physiological factors at time point $t$, and the observable input vector $U_{t}=\{U_{c}(t), U_{e}(t), U_{s}(t), U_{i}(t)\}$ , in which $U_{c}$ stands for the
%carbohydrate proportion of meals, $U_{e}$ indicates the calories cost by exercise,  $U_{s}$ is the sleep score and $U_{i}$ states for the amount of insulin injected or simulated
%by the diabetes drugs  at time point $t$. In particular, the sleep quality $U(s)$ is a constant during a whole day.
%The station transition functions can be represented as $X_{t+1}=f(X_t, U_t)$, and its corresponding
%temporal transition graph is shown as \figref{fig:phymodel}.  %\tabref{phy_tab} details the transformation functions of the carbohydrate $C_{g1}$ and $C_{g2}$, and insulin
%As \figref{fig:phymodel} shown, the equations of $C_{g1}$ (Equation~\ref{Eq:Cg1}) and $C_{g2}$ (Equation~\ref{Eq:Cg2}) indicating the temporal transitions of carbohydrate consumption and the carbohydrate digestion respectively.

%Positive factors of physiological model indicate the carbohydrate absorption and the hepatic glucose production, which will increase the blood glucose level.
%Negative factors of  physiological model describe the insulin independent uptake, insulin dependent uptake and the renal clearance. We will detail these factors as follows:


\emph{Carbohydrate dynamics}: Carbohydrate dynamics refers to the transitions of carbohydrate consumption  $C_{g1}$ and the carbohydrate digestion $C_{g2}$. 
Equation~\ref{Eq:Cg1}  and Equation~\ref{Eq:Cg2} show their transition equations respectively, where $U_{c}$ stands for the carbohydrate proportion of meals.
\begin{equation}\label{Eq:Cg1}
C_{g1}(t+1)=C_{g1}(t)-\alpha_{1}^c*C_{g1}(t)+U_{c}(t)
\end{equation}

\begin{equation}\label{Eq:Cg2}
C_{g2}(t+1)=C_{g2}(t)+\alpha_{1}^c*C_{g1}(t)-\alpha_{2}^c*C_{g1}(t)
\end{equation}

\emph{Insulin dynamics}: Insulin dynamics indicates the transitions of subcutaneous insulin $I_{s}$ (Equation~\ref{Eq:Is}), 
the insulin mass $I_{m}$ (Equation~\ref{Eq:Im}),  and the level of active plasma insulin $I$ (Equation~\ref{Eq:I}). $U_{I}$ 
states for the amount of insulin injected or simulated by the diabetes drugs. $S^I$ and $bm$ refer to the insulin sensitive 
and body mass respectively.

\begin{equation}\label{Eq:Is}
I_{s}(t+1)=I_{s}(t)-\alpha_{f}^I*I_{s}(t)+U_{I}(t)
\end{equation}


\begin{equation}\label{Eq:Im}
I_{m}(t+1)=I_{m}(t)-\alpha_{f}^I*I_{s}(t)-\alpha_c^I*I_{m}(t)
\end{equation}

\begin{equation}\label{Eq:I}
I(t)=\frac{I_{m}(t)*S^I}{142*bm}
\end{equation}

\emph{Exercise dynamics}: Exercise dynamics $E$ denotes the exercise effect on insulin over the past time window. This 
long-term influence can be expressed by a cumulative moving average \cite{bib:lowry1992multivariate, bib:cma} as Equation~\ref{Eq:E} in the physiological model.

\begin{equation}\label{Eq:E}
E(t-t_0+1)=(t-t_0)*E(t-t_0)+U_{e}(t-t_0)
\end{equation}

where $t$ and $t_0$ are the current and beginning time point in the past time window. In \sysname,
the window size of exercise is set to 24 hours, which optimizes the experimental results and matches the conclusion
of clinical studies.

\emph{Sleep dynamics}: Sleep dynamics $S$ represents the sleeping quality effect on insulin. In physiological model, sleeping
effect also has a long-term influence on the insulin as the exercise effects. Specifically, it maintains a constant effect on 
blood glucose for each day. Equation~\ref{Eq:S} shows its transition equation.

\begin{equation}\label{Eq:S}
S(t-t_0+1)=(t-t_0)*S(t-t_0)+U_{s}(t-t_0)
\end{equation},

where $t$ and $t_0$ are the current and beginning time point in the past time window. 
In \sysname, the window size of sleep lasts for 7 days, which optimizes the experimental results and matches the conclusion
of clinical studies.


Insulin dynamics indicates the transitions of subcutaneous insulin $I_{s}$ (Equation~\ref{Eq:Is}),
the insulin mass $I_{m}$ (Equation~\ref{Eq:Im}),  and the level of active plasma insulin $I$ (Equation~\ref{Eq:I}). $U_{I}$
states for the amount of insulin injected or simulated by the diabetes drugs. $S^I$ and $bm$ refer to the insulin sensitive
and body mass respectively.


The impacted results $\delta_{abs}$ of carbohydrate absorption increase the blood glucose concentration can be described as 
$\delta_{abs}=\frac{\alpha_3^c*\alpha_2^c}{1+25/C_{g2}}$

Hepatic glucose production refers to the glucose released by the liver. It depends on the current blood glucose concentration G(t) 
and level of plasma insulin I(t).


The equations of $I_{s}$ (Equation~\ref{Eq:Is}) and $I_{m}$ (Equation~\ref{Eq:Im}) showing the temporal transitions of  the subcutaneous insulin
and the insulin mass respectively. $I$, the level of active plasma insulin, can be achieved by Equation~\ref{Eq:I}, where $S^I$ and $bm$ refer to the
insulin sensitive and body mass respectively.





Based on the positive factors and the negative factors, the blood glucose mass of individual body
$G_m$ can be calculated as Equation~\ref{Eq:Gm}
\begin{equation}\label{Eq:Gm}
G_m(t+1)=G_m(t)+\delta_{abs}-\delta_{ind}-\delta_{dep}-\delta_{clr}+\delta_{egp}
\end{equation},
where $\delta_{abs}=\frac{\alpha_3^c*\alpha_2^c}{1+25/C_{g2}}$

and the blood glucose concentration $G$ can be computed in Equation~\ref{Eq:G}.
\begin{equation}\label{Eq:G}
G_m(t+1)=G_m(t)+\delta_{abs}-\delta_{ind}-\delta_{dep}-\delta_{clr}+\delta_{egp}
\end{equation},


1) Positive factors:
Positive factors indicates the

However, the parameters of this model are different to individuals and also hard to be tuned.

\subsection{Blood glucose level prediction}

\input{rnnWriting}
